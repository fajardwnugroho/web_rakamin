{"title":"Daily Cohort","markdown":{"yaml":{"title":"Daily Cohort","author":"Fajar Nugroho","execute":{"echo":false,"warning":false,"message":false}},"headingText":"Last Updated","containsRefs":false,"markdown":"\n\n\nThursday, 26 May 2022\n\n## Cohort\n\n```{r}\nlibrary(dplyr) #handy data manipulation\nlibrary(ggplot2) #our today's super star\nlibrary(stringr) #to manipulate string date\nlibrary(ggthemes) #many nice themes\nlibrary(mdthemes) #handy text in plot formatting\nlibrary(gghighlight) #will abuse it a bit to show nice label\nlibrary(cellranger)\nlibrary(spreadr)\nlibrary(tidyr)\nlibrary(tidyverse)\nlibrary(reactable)\nlibrary(googlesheets4)\nlibrary(lubridate)\nlibrary(xts)\nlibrary(RColorBrewer)\nlibrary(scales)\nlibrary(writexl)\nlibrary(htmltools) # for building div/links\nlibrary(paletteer) # for all the palettes\nlibrary(crosstalk)\n```\n\n```{r, eval=TRUE}\ndf <- read.csv(\"data/relay-food.csv\")\n```\n\n\n```{r}\n# Apparently, the date format in the column`OrderDate` is not standard yet. Therefore we need to adjust it.\n```\n\n```{r}\n# adjust date formatting of OrderDate column\ndf$OrderDate = format(as.Date(df$OrderDate, '%m/%d/%Y'), '%Y/%m/%d')\ndf$OrderDate = gsub('00','20',df$OrderDate)\n```\n\n\n```{r}\n# Next, since we want to look at the monthly cohort, we need to derive `OrderMonth` column from `OrderDate` column.\n```\n\n\n```{r}\n# create OrderMonth column from OrderDate (to  make monthly cohort)\ndf$OrderMonth = str_sub(df$OrderDate,end = 7)\n```\n\n```{r}\n# Cohort analysis requires cohort group information for each user in the dataset, so we build one.\n```\n\n\n```{r}\n# create reference data frame of cohort group (month level)\ncohort_group_df = df %>% group_by(UserId) %>% \n                    summarize(CohortGroup = min(OrderDate))\ncohort_group_df$CohortGroup =  str_sub(cohort_group_df$CohortGroup,                    end = 7) \n# join with the initial df\ndf = inner_join(df, cohort_group_df, by = 'UserId')\n```\n\n```{r}\n# Next, we create a reference dataframe containing the total users for each cohort group, as well as the monthly count of users who made purchases.\n```\n\n\n```{r}\n# create reference data frame of total users for each cohort group\nbase_cohort_df = df %>% group_by(CohortGroup) %>%\n  summarise(\n   TotalUsers = n_distinct(UserId)\n  )\n# create purchase activity data frame\nactivity_cohort_df = df %>% group_by(CohortGroup, OrderMonth) %>%\n summarise(\n  BuyingUsers = n_distinct(UserId)\n )\n# join activity_cohort_df and base_cohort_df\nuser_cohort_df = inner_join(activity_cohort_df, base_cohort_df, \n                  by = 'CohortGroup')\n```\n\n```{r}\n# Data checkpoint. What we have got so far?\n```\n\n\n```{r}\n# user_cohort_df %>% head(5)\n```\n\n```{r}\n# Notice `OrderMonth` column is still in string format as above. For plotting, we want it to be in integer format to become the x-axis.\n```\n\n\n```{r}\n# transform OrderMonth to integer\nuser_cohort_df = user_cohort_df %>% group_by(CohortGroup) %>% mutate(MonthNumber = 1:n())\n```\n\n```{r}\n# Finally, we will only plot a subset of the data to avoid overplotting.\n```\n\n\n```{r}\n# subsetting the data\nplot_user_cohort_df = inner_join(base_cohort_df[seq(1,11,2),c(\"CohortGroup\")], user_cohort_df, by = \"CohortGroup\")\n```\n\n```{r}\n# In the plot to be drawn, I wanted to have nice legends where they are put right at the end of the lines. To do so, I use gghighlight package. I know this is somewhat hacky, so please comment below if you guys know a more proper way to do it.\n```\n\n\n```{r}\n# dummy column for in-place legend\nplot_user_cohort_df$dummy_col = 1\n```\n\n```{r}\n# Alright, we are done with data preparation for the line plot. Below is the final form of the data.\n```\n\n\n```{r}\n# plot_user_cohort_df %>% head(5)\n```\n\n```{r}\n# So, we are ready to have our first plot!\n```\n\n\n```{r}\n# plotting line plot\nplot1 <- ggplot(plot_user_cohort_df) +\n  geom_line(aes(x = MonthNumber,\n                y = BuyingUsers/TotalUsers,\n                col = CohortGroup)) +\n  gghighlight(dummy_col == 1) +\n  scale_x_continuous(breaks = seq(from = 1, to = 15, by = 2)) +\n  scale_y_continuous(labels = scales::percent_format()) +\n  mdthemes::md_theme_solarized() +\n  labs(\n    title = \"**Monthly User Purchasing Cohort**\",\n    caption = \"*Data: Relay Food order details (Source: github.com/ethen8181)*\", \n    x = \"K-th Month\",\n    y = \"Retention\",\n    col = \"Cohort Group\"\n  )\n```\n\n```{r}\n# create base dataframe for heat map visualization\ncohort_heatmap_df = user_cohort_df %>% select(CohortGroup, MonthNumber, BuyingUsers) %>%\n          spread(MonthNumber, BuyingUsers)\n# inspect data\n# cohort_heatmap_df %>% head(5) \n```\n\n```{r}\n# the percentage version of the dataframe\ncohort_heatmap_df_pct = data.frame(\n  cohort_heatmap_df$CohortGroup,\n  cohort_heatmap_df[,2:ncol(cohort_heatmap_df)] / cohort_heatmap_df[[\"1\"]]\n)\n# assign the same column names\ncolnames(cohort_heatmap_df_pct) = colnames(cohort_heatmap_df)\n```\n\n\n```{r}\nplot_data_abs = gather(cohort_heatmap_df, \"MonthNumber\", \"BuyingUsers\", 2:ncol(cohort_heatmap_df))\nplot_data_pct = gather(cohort_heatmap_df_pct, \"MonthNumber\", \"Retention\", 2:ncol(cohort_heatmap_df_pct))\n```\n\n\n```{r}\nlabel_names = c(plot_data_abs$BuyingUsers[1:(ncol(cohort_heatmap_df)-1)],plot_data_pct$Retention[(ncol(cohort_heatmap_df_pct)):(nrow(plot_data_pct))])\n```\n\n\n```{r}\n# beautify percentage labels\nbeauty_print <- function(n) {\n  case_when( n <= 1  ~ sprintf(\"%1.0f %%\", n*100),\n             n >  1  ~ as.character(n),\n             TRUE    ~ \" \") # for NA values, skip the label\n}\n# create dataframe ready for plotting\nplot_data = data.frame(\n  CohortGroup = plot_data_pct$CohortGroup,\n  MonthNumber = plot_data_pct$MonthNumber,\n  Retention = plot_data_pct$Retention,\n  Label = beauty_print(label_names)\n)\nplot_data$MonthNumber = as.numeric(plot_data$MonthNumber)\n```\n\n\n```{r}\nplot_bi_muamalat <- read_sheet(\"https://docs.google.com/spreadsheets/d/1utMFZfdIcn3I2DakMf0NyZ2QNELUcaorJA-GjZE6Nxk/edit#gid=123180458\", range = \"cohort-bank-muamalat-bi-analytics\")\n\nplot_bi_muamalat$Label = beauty_print(plot_bi_muamalat$Label)\n\nplot_dm_erajaya <- read_sheet(\"https://docs.google.com/spreadsheets/d/1utMFZfdIcn3I2DakMf0NyZ2QNELUcaorJA-GjZE6Nxk/edit#gid=497909851\", range = \"cohort-erajaya-dm\")\n\nplot_dm_erajaya$Label = beauty_print(plot_dm_erajaya$Label)\n\nplot_ds_idx <- read_sheet(\"https://docs.google.com/spreadsheets/d/1utMFZfdIcn3I2DakMf0NyZ2QNELUcaorJA-GjZE6Nxk/edit#gid=817098153\", range = \"cohort-idx-ds\")\n\nplot_ds_idx$Label = beauty_print(plot_ds_idx$Label)\n\nplot_be_investree <- read_sheet(\"https://docs.google.com/spreadsheets/d/1utMFZfdIcn3I2DakMf0NyZ2QNELUcaorJA-GjZE6Nxk/edit#gid=2070693287\", range = \"cohort-investree-be\")\n\nplot_be_investree$Label = beauty_print(plot_be_investree$Label)\n\nplot_fs_investree <- read_sheet(\"https://docs.google.com/spreadsheets/d/1utMFZfdIcn3I2DakMf0NyZ2QNELUcaorJA-GjZE6Nxk/edit#gid=918789044\", range = \"cohort-investree-fs\")\n\nplot_fs_investree$Label = beauty_print(plot_fs_investree$Label)\n\nplot_cp_jackmall <- read_sheet(\"https://docs.google.com/spreadsheets/d/1utMFZfdIcn3I2DakMf0NyZ2QNELUcaorJA-GjZE6Nxk/edit#gid=2109982603\", range = \"cohort-jackmall-cp\")\n\nplot_cp_jackmall$Label = beauty_print(plot_cp_jackmall$Label)\n\nplot_bda_kimiafarma <- read_sheet(\"https://docs.google.com/spreadsheets/d/1utMFZfdIcn3I2DakMf0NyZ2QNELUcaorJA-GjZE6Nxk/edit#gid=811593669\", range = \"cohort-kimiafarma-bda\")\n\nplot_bda_kimiafarma$Label = beauty_print(plot_bda_kimiafarma$Label)\n\nplot_seo_niagahoster <- read_sheet(\"https://docs.google.com/spreadsheets/d/1utMFZfdIcn3I2DakMf0NyZ2QNELUcaorJA-GjZE6Nxk/edit#gid=929047325\", range = \"cohort-niagahoster-seo\")\n\nplot_seo_niagahoster$Label = beauty_print(plot_seo_niagahoster$Label)\n\nplot_overall <- read_sheet(\"https://docs.google.com/spreadsheets/d/1utMFZfdIcn3I2DakMf0NyZ2QNELUcaorJA-GjZE6Nxk/edit#gid=1177792059\", range = \"cohort-overall\")\n\nplot_overall$Label = beauty_print(plot_overall$Label)\n```\n\n\n### Cohort Overall\n\n```{r}\nggplot(plot_overall) +\n  geom_raster(aes(x = DayNumber,\n                  y = reorder(CohortGroup, desc(CohortGroup)),\n                  fill = Retention)) +\n  scale_fill_continuous(guide = FALSE, type = \"gradient\",\n                        low = \"deepskyblue\", high = \"darkblue\") +\n  scale_x_continuous(breaks = seq(from = 1, to = 15, by = 1),\n                     expand = c(0,0)) +\n  geom_text(aes(x = DayNumber,\n                y = reorder(CohortGroup, desc(CohortGroup)),\n                label = Label), col = \"white\") +\n  mdthemes::md_theme_gray() +\n  labs(\n    title = \"**Daily User Retention VIX-Overall**\",\n    caption = \"*Data: Cohort & user retention (Source: google analytis)*\", \n    x = \"D-th Day\",\n    y = \"Cohort Group\"\n  )\n```\n\n### Cohort BI Analyst Bank Muamalat\n\n```{r}\n# plotting heatmap\nggplot(plot_bi_muamalat) +\n  geom_raster(aes(x = DayNumber,\n                  y = reorder(CohortGroup, desc(CohortGroup)),\n                  fill = Retention)) +\n  scale_fill_continuous(guide = FALSE, type = \"gradient\",\n                        low = \"deepskyblue\", high = \"darkblue\") +\n  scale_x_continuous(breaks = seq(from = 1, to = 15, by = 1),\n                     expand = c(0,0)) +\n  geom_text(aes(x = DayNumber,\n                y = reorder(CohortGroup, desc(CohortGroup)),\n                label = Label), col = \"white\") +\n  mdthemes::md_theme_gray() +\n  labs(\n    title = \"**Daily User Retention VIX-BI Analyst-Bank Muamalat**\",\n    caption = \"*Data: Cohort & user retention (Source: google analytis)*\", \n    x = \"D-th Day\",\n    y = \"Cohort Group\"\n  )\n```\n\n### Cohort Digital Marketing Erajaya\n\n```{r}\n# plotting heatmap\nggplot(plot_dm_erajaya) +\n  geom_raster(aes(x = DayNumber,\n                  y = reorder(CohortGroup, desc(CohortGroup)),\n                  fill = Retention)) +\n  scale_fill_continuous(guide = FALSE, type = \"gradient\",\n                        low = \"deepskyblue\", high = \"darkblue\") +\n  scale_x_continuous(breaks = seq(from = 1, to = 15, by = 1),\n                     expand = c(0,0)) +\n  geom_text(aes(x = DayNumber,\n                y = reorder(CohortGroup, desc(CohortGroup)),\n                label = Label), col = \"white\") +\n  mdthemes::md_theme_gray() +\n  labs(\n    title = \"**Daily User Retention VIX-DM-Erajaya**\",\n    caption = \"*Data: Cohort & user retention (Source: google analytis)*\", \n    x = \"D-th Day\",\n    y = \"Cohort Group\"\n  )\n```\n\n### Cohort Data Science ID/X Partner\n\n```{r}\n# plotting heatmap\nggplot(plot_ds_idx) +\n  geom_raster(aes(x = DayNumber,\n                  y = reorder(CohortGroup, desc(CohortGroup)),\n                  fill = Retention)) +\n  scale_fill_continuous(guide = FALSE, type = \"gradient\",\n                        low = \"deepskyblue\", high = \"darkblue\") +\n  scale_x_continuous(breaks = seq(from = 1, to = 15, by = 1),\n                     expand = c(0,0)) +\n  geom_text(aes(x = DayNumber,\n                y = reorder(CohortGroup, desc(CohortGroup)),\n                label = Label), col = \"white\") +\n  mdthemes::md_theme_gray() +\n  labs(\n    title = \"**Daily User Retention VIX-DS-ID/X**\",\n    caption = \"*Data: Cohort & user retention (Source: google analytis)*\", \n    x = \"D-th Day\",\n    y = \"Cohort Group\"\n  )\n```\n\n### Cohort Backend Investree\n\n```{r}\n# plotting heatmap\nggplot(plot_be_investree) +\n  geom_raster(aes(x = DayNumber,\n                  y = reorder(CohortGroup, desc(CohortGroup)),\n                  fill = Retention)) +\n  scale_fill_continuous(guide = FALSE, type = \"gradient\",\n                        low = \"deepskyblue\", high = \"darkblue\") +\n  scale_x_continuous(breaks = seq(from = 1, to = 15, by = 1),\n                     expand = c(0,0)) +\n  geom_text(aes(x = DayNumber,\n                y = reorder(CohortGroup, desc(CohortGroup)),\n                label = Label), col = \"white\") +\n  mdthemes::md_theme_gray() +\n  labs(\n    title = \"**Daily User Retention VIX-Backend-Investree**\",\n    caption = \"*Data: Cohort & user retention (Source: google analytis)*\", \n    x = \"D-th Day\",\n    y = \"Cohort Group\"\n  )\n```\n\n### Cohort Fullstack Investree\n\n```{r}\n# plotting heatmap\nggplot(plot_fs_investree) +\n  geom_raster(aes(x = DayNumber,\n                  y = reorder(CohortGroup, desc(CohortGroup)),\n                  fill = Retention)) +\n  scale_fill_continuous(guide = FALSE, type = \"gradient\",\n                        low = \"deepskyblue\", high = \"darkblue\") +\n  scale_x_continuous(breaks = seq(from = 1, to = 15, by = 1),\n                     expand = c(0,0)) +\n  geom_text(aes(x = DayNumber,\n                y = reorder(CohortGroup, desc(CohortGroup)),\n                label = Label), col = \"white\") +\n  mdthemes::md_theme_gray() +\n  labs(\n    title = \"**Daily User Retention VIX-Fullstack-Investree**\",\n    caption = \"*Data: Cohort & user retention (Source: google analytis)*\", \n    x = \"D-th Day\",\n    y = \"Cohort Group\"\n  )\n```\n\n### Cohort Campaign Performance Jackmall\n\n```{r}\n# plotting heatmap\nggplot(plot_cp_jackmall) +\n  geom_raster(aes(x = DayNumber,\n                  y = reorder(CohortGroup, desc(CohortGroup)),\n                  fill = Retention)) +\n  scale_fill_continuous(guide = FALSE, type = \"gradient\",\n                        low = \"deepskyblue\", high = \"darkblue\") +\n  scale_x_continuous(breaks = seq(from = 1, to = 15, by = 1),\n                     expand = c(0,0)) +\n  geom_text(aes(x = DayNumber,\n                y = reorder(CohortGroup, desc(CohortGroup)),\n                label = Label), col = \"white\") +\n  mdthemes::md_theme_gray() +\n  labs(\n    title = \"**Daily User Retention VIX-Campaign Digital Performance-Jackmall**\",\n    caption = \"*Data: Cohort & user retention (Source: google analytis)*\", \n    x = \"D-th Day\",\n    y = \"Cohort Group\"\n  )\n```\n\n### Cohort Big Data Analytics Kimia Farma\n\n```{r}\n# plotting heatmap\nggplot(plot_bda_kimiafarma) +\n  geom_raster(aes(x = DayNumber,\n                  y = reorder(CohortGroup, desc(CohortGroup)),\n                  fill = Retention)) +\n  scale_fill_continuous(guide = FALSE, type = \"gradient\",\n                        low = \"deepskyblue\", high = \"darkblue\") +\n  scale_x_continuous(breaks = seq(from = 1, to = 15, by = 1),\n                     expand = c(0,0)) +\n  geom_text(aes(x = DayNumber,\n                y = reorder(CohortGroup, desc(CohortGroup)),\n                label = Label), col = \"white\") +\n  mdthemes::md_theme_gray() +\n  labs(\n    title = \"**Daily User Retention VIX-Big Data Analysis-Kimia Farma**\",\n    caption = \"*Data: Cohort & user retention (Source: google analytis)*\", \n    x = \"D-th Day\",\n    y = \"Cohort Group\"\n  )\n```\n\n### Cohort SEO Niagahoster\n\n```{r}\n# plotting heatmap\nggplot(plot_seo_niagahoster) +\n  geom_raster(aes(x = DayNumber,\n                  y = reorder(CohortGroup, desc(CohortGroup)),\n                  fill = Retention)) +\n  scale_fill_continuous(guide = FALSE, type = \"gradient\",\n                        low = \"deepskyblue\", high = \"darkblue\") +\n  scale_x_continuous(breaks = seq(from = 1, to = 15, by = 1),\n                     expand = c(0,0)) +\n  geom_text(aes(x = DayNumber,\n                y = reorder(CohortGroup, desc(CohortGroup)),\n                label = Label), col = \"white\") +\n  mdthemes::md_theme_gray() +\n  labs(\n    title = \"**Daily User Retention VIX-SEO-Niagahoster**\",\n    caption = \"*Data: Cohort & user retention (Source: google analytis)*\", \n    x = \"D-th Day\",\n    y = \"Cohort Group\"\n  )\n```"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"daily.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"0.9.270","editor":"visual","theme":"darkly","title":"Daily Cohort","author":"Fajar Nugroho"},"extensions":{"book":{"multiFile":true}}}}}